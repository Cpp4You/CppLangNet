---
sidebar_label:		ğŸ“ ObsÅ‚uga plikÃ³w
title:				ObsÅ‚uga plikÃ³w
tags:				[plik, fstream, odczyt, zapis]
description:		"ArtykuÅ‚ (podstawy): obsÅ‚uga plikÃ³w w jÄ™zyku C++"
hide_title:			true
---

<!-- Presets -->
import ImproveSection		from "@site/i18n/pl/presets/ImproveSection.mdx";

<!-- Components -->
import Tabs					from "@theme/Tabs";
import TabItem				from "@theme/TabItem";
import Details				from "@theme/Details";
import Columns				from "@site-comps/Columns";
import CustomCodeBlock		from "@site-comps/CustomCodeBlock";
import Image				from "@site-comps/Image";
import Replit				from "@site-comps/Replit";

<!-- Codes -->
import Example_FilesystemAliasGlobal		from "./_codes/files/example-filesystem-alias-global.mdx";
import Example_FilesystemAliasWithinFunc	from "./_codes/files/example-filesystem-alias-within-func.mdx";

import Code_OpenFileFstream					from "./_codes/files/open-file-fstream.mdx";
import Code_OpenFileIfstream				from "./_codes/files/open-file-ifstream.mdx";
import Code_OpenFileOfstream				from "./_codes/files/open-file-ofstream.mdx";

import Code_OpenFileFstreamExample			from "./_codes/files/open-file-fstream-example.mdx";
import Code_OpenFileIfstreamExample			from "./_codes/files/open-file-ifstream-example.mdx";
import Code_OpenFileOfstreamExample			from "./_codes/files/open-file-ofstream-example.mdx";


# ObsÅ‚uga plikÃ³w

Wymaga znajomoÅ›ci: [**1. Pierwszy program**](../../first-program) - [**9. Metody**](../../methods) oraz [**11. Referencje**](../../references)

W tym artykule pokaÅ¼emy Ci jak poprawnie korzystaÄ‡ z plikÃ³w w jÄ™zyku C++.

## Motywacja

UÅ¼ywanie plikÃ³w ğŸ“ jest czÄ™sto niezbÄ™dnÄ… czÄ™Å›ciÄ… aplikacji. Programy przechowujÄ… swoje dane
miÄ™dzy innymi na dysku komputerowym. Aplikacje biurowe zapisujÄ… dokumenty utworzone przez uÅ¼ytkownika.
CzÄ™sto korzystajÄ… z plikÃ³w konfiguracyjnych, ktÃ³re rÃ³wnieÅ¼ znajdujÄ… siÄ™ na dysku. Gry wideo trzymajÄ… modele, dÅºwiÄ™ki,
tekstury i innÄ… tego typu zawartoÅ›Ä‡ wewnÄ…trz swoich plikÃ³w.

<Image center
		alt="WyÅ›wietlanie zawartoÅ›ci pliku"
		src="/img/tutorials/course/basic/files/displaying-file-content.png"
		desc="WyÅ›wietlanie zawartoÅ›ci pliku"
	/>

## Operacje na pliku

### WstÄ™p

W kodzie z tego artykuÅ‚u bÄ™dziemy korzystali z nastÄ™pujÄ…cego nagÅ‚Ã³wka z biblioteki standardowej:

```cpp
#include <fstream>
```

Pozwoli on nam na obsÅ‚ugÄ™ pojedynczego pliku i jego zawartoÅ›ci, w tym:

- stworzenie pliku
- odczyt danych
- zapisanie danych

### Otwieranie pliku

Å»eby w ogÃ³le mÃ³c korzystaÄ‡ z zawartoÅ›ci pliku, musimy go otworzyÄ‡ za pomocÄ… odpowiedniego obiektu
z biblioteki standardowej. W zaleÅ¼noÅ›ci od tego czy chcemy jedynie odczytywaÄ‡ dane, czy tylko zapisywaÄ‡,
czy robiÄ‡ obydwie te rzeczy, uÅ¼yjemy obiektu innego typu.

Przy obsÅ‚udze plikÃ³w w jÄ™zyku C++ korzystamy z obiektÃ³w typu `std::fstream` oraz jego wariantÃ³w,
w postaci `std::ifstream` i `std::ofstream`.

<Tabs>
	<TabItem label="ğŸ”¹ Tryb do odczytu" value="ifstream" default>
		<Code_OpenFileIfstream />
	</TabItem>
	<TabItem label="ğŸ’¡ PrzykÅ‚ad" value="example">
		<Code_OpenFileIfstreamExample />
	</TabItem>
</Tabs>

<Tabs>
	<TabItem label="ğŸ”¹ Tryb do zapisu" value="ofstream" default>
		<Code_OpenFileOfstream />
	</TabItem>
	<TabItem label="ğŸ’¡ PrzykÅ‚ad" value="example">
		<Code_OpenFileOfstreamExample />
	</TabItem>
</Tabs>

:::important Przedrostki
ZwrÃ³Ä‡ uwagÄ™ na rÃ³Å¼nicÄ™ <code>std::<b>i</b>fstream</code> (ang.: *<b>i</b>nput file stream*) i <code>std::<b>o</b>fstream</code> (ang.: *<b>o</b>utput file stream*).
:::

Aby otworzyÄ‡ plik w obydwu trybach jednoczeÅ›nie uÅ¼ywamy `std::fstream` (bez przedrostka **`i`** ani **`o`**).

<Tabs>
	<TabItem label="ğŸ”¹ Tryb do odczytu i zapisu" value="fstream" default>
		<Code_OpenFileFstream />
	</TabItem>
	<TabItem label="ğŸ’¡ PrzykÅ‚ad" value="example">
		<Code_OpenFileFstreamExample />
	</TabItem>
</Tabs>

### Odczyt i zapis danych

Z obiektu `file`, ktÃ³ry utworzyliÅ›my wyÅ¼ej korzystamy w bardzo podobny sposÃ³b do
tego jak uÅ¼ywaliÅ›my `std::cin` oraz `std::cout`. Interfejsy tych obiektÃ³w zostaÅ‚y
w bibliotece standardowej ujednolicone - kaÅ¼dy z nich jest "strumieniem",
na ktÃ³rym moÅ¼emy wykonywaÄ‡ operacje za pomocÄ… operatorÃ³w `<<` oraz `>>`:

UtwÃ³rz rÄ™cznie plik `plik.txt` w ogÃ³lnodostÄ™pnym miejscu na dysku, np. utwÃ³rz folder `zadanie`
na dysku C (na Windowsie) - `C:/zadanie/plik.txt` lub folderze uÅ¼ytkownika (na Linuxie: `/home/username/`).

```plaintext title="ZawartoÅ›Ä‡ 'plik.txt'"
ala ma 1 kota
oraz 2 psy
```

#### Otwarcie pliku

:::note ÅšcieÅ¼ki bezwzglÄ™dne
Na tym etapie bÄ™dziemy posÅ‚ugiwaÄ‡ siÄ™ tylko **Å›cieÅ¼kami bezwzglÄ™dnymi**, czyli takimi ktÃ³re precyzyjnie
okreÅ›lajÄ… poÅ‚oÅ¼enie pliku na komputerze. CzytajÄ…c artykuÅ‚ dalej, poznasz teÅ¼ **Å›cieÅ¼ki wzglÄ™dne**,
ktÃ³re zawsze okreÅ›lajÄ… poÅ‚oÅ¼enie wzglÄ™dem tzw. *folderu roboczego*.
:::

UÅ¼ywamy wczeÅ›niej poznanej metody:

```cpp
#include <iostream>
#include <fstream>

int main() {
	auto file = std::fstream("C:/zadanie/plik.txt");

	// dalsze operacje
}
```

:::danger Slash i backslash
System Windows uÅ¼ywa domyÅ›lnie znaku backslash (`\`) jako separatora w Å›cieÅ¼kach.
Ten sam znak ma rÃ³wnieÅ¼ [specjalne znaczenie](#) w tekÅ›cie w C++. PodajÄ…c Å›cieÅ¼kÄ™
do pliku rÄ™cznie w kodzie, np:

```cpp
auto file = std::ifstream("C:\\zadanie\\plik.txt");
```

uÅ¼yj podwÃ³jnego znaku backslash (`\\`) tak jak powyÅ¼ej, lub zastÄ…p je znakiem slash (`/`).
:::

#### Odczyt

Plik zawiera dwie linie, ktÃ³re sÄ… podzielone na "sÅ‚owa" - `ala`, `ma`, `1`, `kota` itd.

:::caution Odczyt za pomocÄ… `>>`
Tak jak w przypadku `std::cin` wczytywanie danych za pomocÄ… operatora `>>`
zatrzymuje siÄ™ na pierwszym [biaÅ‚ym znaku](#) - spacji, tabulacji czy nowej linii.
:::

WyÅ›wietlmy je w pÄ™tli:

```cpp
// âš  nie zapomnij o include <string>
std::string word;
while (file >> word) {
	std::cout << "Slowo: " << word << '\n';
}
```

ZauwaÅ¼, Å¼e odczyt `file >> word` umieÅ›ciliÅ›my w **warunku pÄ™tli**, poniewaÅ¼ po prÃ³bie wykonania odczytu,
`operator>>` zwrÃ³ci wynik, ktÃ³ry pozwoli nam okreÅ›liÄ‡ czy operacja siÄ™ powiodÅ‚a czy nie.

:::info Ciekawostka
Wynik operatora `>>` jest *konwertowalny* na typ `bool` (`true` / `false`),
wiÄ™c moÅ¼e zostaÄ‡ wstawiony do warunku pÄ™tli.
:::

W naszym wypadku niepowodzenie moÅ¼e nastÄ™piÄ‡ dopiero przy koÅ„cu pliku.

#### Wczytywanie caÅ‚ych linii

Aby wczytaÄ‡ caÅ‚Ä… liniÄ™ z pliku, uÅ¼ywamy funkcji `std::getline`, w ten sposÃ³b:

```cpp title="ğŸ”¹ Wczytanie linii z pliku"
std::string line;
std::getline(file, line);
```

Aby wczytaÄ‡ caÅ‚y plik linia po linii, umieszczamy `getline` w warunku pÄ™tli `while`,
tak samo jak zrobiliÅ›my wyÅ¼ej z operatorem `>>`:

```cpp title="ğŸ”¹ Wczytanie caÅ‚ego pliku"
std::string line;
while (std::getline(file, line)) {
	std::cout << "Linia: " << line << '\n';
}
```

#### Zapis

ChcÄ…c zapisaÄ‡ dane do pliku, skorzystamy z tego samego operatora co przy `std::cout`:

```cpp
int age = 23;
file << "Mam " << age << " lata\n";
```

Operator `<<` potrafi korzystaÄ‡ z tych samych typÃ³w zmiennych co `std::cout`.


### Pozycja operacji w pliku

Operacje zapisu i odczytu na pliku sÄ… wykonywane wzglÄ™dem wewnÄ™trznej pozycji w pliku.

### Tryby otwarcia

TworzÄ…c obiekt typu `std::fstream` lub jego wariantÃ³w, moÅ¼emy opcjonalnie okreÅ›liÄ‡
w drugim parametrze tryb otwarcia pliku:

```cpp
auto file = std::fstream("plik.txt", tryb);
```

Dopuszczalne wartoÅ›ci:

| Tryb | Opis |
|------|------|
| `std::ios::in` | do odczytu |
| `std::ios::out` | do zapisu |
| `std::ios::app` | do zapisu, ale zawsze dopisujemy na koniec pliku |
| `std::ios::trunc` | do zapisu, ale przy otwarciu zawartoÅ›Ä‡ jest tracona |
| `std::ios::binary` | tryb binarny (wiÄ™cej o tym niÅ¼ej) |
| `std::ios::ate` | ustawia domyÅ›lnÄ… pozycjÄ™ zapisu i odczytu na koniec |

Podane poniÅ¼ej tryby moÅ¼na ze sobÄ… Å‚Ä…czyÄ‡ za pomocÄ… operatora `|`.

#### DomyÅ›lne tryby

`std::fstream` domyÅ›lnie otwiera plik w trybie `std::ios::in | std::ios::out` (do odczytu i do zapisu):

```cpp
auto file = std::fstream("plik.txt");
```

Ten zapis jest rÃ³wnowaÅ¼ny z tym:

```cpp
auto file = std::fstream("plik.txt", std::ios::in | std::ios::out);
```

KaÅ¼da z trzech klas: `std::fstream`, `std::ifstream` i `std::ofstream` posiada swoje
domyÅ›lne tryby otwarcia. Oto one:

<!-- The pipe character | can be escaped with &#124; -->

| Klasa | DomyÅ›lny tryb |
|------|--------------|
| `std::fstream` | <code>std::ios::in &#124; std::ios::out</code> |
| `std::ifstream` | `std::ios::in` |
| `std::ofstream` | `std::ios::out` |

#### Tryb binarny



## PrzykÅ‚ady

<ImproveSection />

## Potencjalne bÅ‚Ä™dy

### Niepoprawne wykorzystanie `eof()`

CzÄ™sto moÅ¼emy natknÄ…Ä‡ siÄ™ na kod, ktÃ³ry odczytuje dane w ten sposÃ³b:
		
```cpp title="âŒ Å¹le"
std::string word;
while (!file.eof())
{
	file >> word;
	std::cout << word << '\n';
}
```

Metoda `eof()` sprawdza czy dotarliÅ›my do koÅ„ca pliku (ang.: *end of file*), jednak
to podejÅ›cie jest **niepoprawne**! ZauwaÅ¼, Å¼e nie sprawdzamy czy operacja `>>` siÄ™ powiodÅ‚a
przed wypisaniem `word`!

### Przekazywanie do funkcji bez referencji

Obiekty typu `std::fstream` i jego wariacje zawsze przekazujemy do funkcji przez **referencjÄ™**,
poniewaÅ¼ kopiowanie ich do parametru jest zabronione!

<Tabs>
<TabItem label="âŒ Å¹le" value="bad" default>

```cpp
// error-next-line
auto readLines(std::fstream file) // âŒ Uwaga: brak referencji
{
	auto lines = std::vector<std::string>();

	std::string line;
	while (std::getline(file, line))
		lines.push_back(line);

	return lines;
}
```

</TabItem>
<TabItem label="âœ” Dobrze" value="good">

```cpp
auto readLines(std::fstream& file)
{
	auto lines = std::vector<std::string>();

	std::string line;
	while (std::getline(file, line))
		lines.push_back(line);

	return lines;
}
```

</TabItem>
</Tabs>